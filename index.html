<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Monek System v4.5 - Reordered</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root {
            --gold: #ffcc33;
            --dark-overlay: rgba(10, 10, 10, 0.96);
            --bg-main: url('https://raw.githubusercontent.com/cryptokakhnych/monek-system-v2/refs/heads/main/BEE1273C-8A49-4B01-B2D5-31E01244A38C.png');
            --bg-loader: url('https://raw.githubusercontent.com/cryptokakhnych/monek-system-v2/refs/heads/main/DE0BFEBD-58A8-4CA4-A803-10BDD5E177A2.png');
            --bg-menu: url('https://raw.githubusercontent.com/cryptokakhnych/monek-system-v2/refs/heads/main/F4AAC9F1-4AFA-411A-8D97-82C5F86FE825.png');
            --bg-hours: url('https://raw.githubusercontent.com/cryptokakhnych/monek-system-v2/refs/heads/main/2A2B5DCA-E3CC-4307-AA90-BEC512A1BC8A.png');
        }

        * {
            margin: 0; padding: 0; box-sizing: border-box;
            -webkit-tap-highlight-color: transparent; -webkit-user-select: none; user-select: none;
        }

        input { -webkit-user-select: text; user-select: text; }

        body, html {
            width: 100%; height: 100%; background-color: #000;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            overflow: hidden;
        }

        .screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; display: none; z-index: 1; }

        .canvas {
            position: relative; width: 100%; height: 100%;
            background-size: 100% 100%; background-position: center top; background-repeat: no-repeat;
            display: flex; flex-direction: column; align-items: center;
        }

        #loader-screen .canvas { background-image: var(--bg-loader); }
        #menu-screen .canvas { background-image: var(--bg-menu); }
        #hours-screen .canvas { background-image: var(--bg-hours); }
        #advances-screen .canvas, #dayoff-screen .canvas, #shop-screen .canvas, 
        #profile-screen .canvas, #clocks-screen .canvas, #account-screen .canvas, 
        #top-screen .canvas, #workers-screen .canvas { background-image: var(--bg-main); }

        .top-logo-box { position: absolute; top: -5.5%; width: 100%; display: flex; justify-content: center; z-index: 5; }
        .header-logo { width: 210px; pointer-events: none; }

        .menu-container {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: 10;
        }

        .menu-item {
            position: absolute;
            display: flex;
            justify-content: center;
            align-items: center;
            border: 2px solid red; /* Красная рамка */
            background: rgba(255, 0, 0, 0.1);
        }

        .menu-icon {
            max-width: 100%;
            max-height: 100%;
            cursor: pointer;
            filter: drop-shadow(0 4px 6px rgba(0,0,0,0.4));
            transition: transform 0.2s ease;
        }

        /* ===========================================================
           НАСТРОЙКА РАЗМЕРА КАЖДОЙ ИКОНКИ ОТДЕЛЬНО
           =========================================================== */
        #img-profile  { transform: scale(2.5); }
        #img-clocks   { transform: scale(2.5); }
        #img-advances { transform: scale(2.5); }
        #img-top      { transform: scale(2.5); }
        #img-shop     { transform: scale(2.7); }
        #img-account  { transform: scale(2.9); }
        #img-workers  { transform: scale(2.8); }
        #img-dayoff   { transform: scale(2.5); }

        /* ===========================================================
           НАСТРОЙКА ПОЗИЦИЙ (ПЕРЕСТАВЛЕНЫ КНОПКИ)
           =========================================================== */
        
        /* 1. ВЕРХНИЙ РЯД (без изменений) */
        #m-profile  { top: 34%; left: 20.0%; width: 20%; height: 10%; }
        #m-clocks   { top: 33.5%; left: 60.5%; width: 20%; height: 10%; }
        
        /* 2. ВТОРОЙ РЯД (Слева теперь РАБОТНИКИ) */
        #m-workers  { top: 47%; left: 20.0%; width: 20%; height: 10%; }
        #m-top      { top: 47%; left: 60.5%; width: 20%; height: 10%; }
        
        /* 3. ТРЕТИЙ РЯД (Слева теперь АВАНСЫ) */
        #m-advances { top: 59.5%; left: 19.5%; width: 20%; height: 10%; }
        #m-account  { top: 59.5%; left: 60%; width: 20%; height: 10%; }
        
        /* 4. ЧЕТВЕРТЫЙ РЯД (Слева теперь МАГАЗИН) */
        #m-shop     { top: 72.5%; left: 20.0%; width: 20%; height: 10%; }
        #m-dayoff   { top: 72.5%; left: 59.5%; width: 20%; height: 10%; }

        /* =========================================================== */

        /* ЛОАДЕР */
        .loader-content { position: absolute; top: 46%; width: 100%; display: flex; flex-direction: column; align-items: center; }
        .progress-container { width: 60%; height: 14px; background: rgba(0,0,0,0.6); border-radius: 20px; border: 2px solid rgba(255,255,255,0.4); overflow: hidden; }
        .progress-bar { height: 100%; width: 0%; background: linear-gradient(90deg, #ffcc33, #ff6600); }
        #loading-text { color: var(--gold); font-size: 20px; margin-top: 12px; font-weight: 900; -webkit-text-stroke: 1.2px black; text-shadow: 2px 2px 0px rgba(0,0,0,1); }

        /* ИНТЕРФЕЙС ПАНЕЛЕЙ */
        .panel-container {
            width: 78%; background: var(--dark-overlay);
            border: 1px solid var(--gold); border-radius: 12px;
            padding: 12px; display: flex; flex-direction: column;
            align-items: center; box-shadow: 0 10px 40px rgba(0,0,0,0.9);
        }
        .panel-title { color: var(--gold); font-weight: 900; text-transform: uppercase; margin-bottom: 10px; font-size: 13px; }
        .panel-input { width: 100%; padding: 10px; margin-bottom: 8px; border: 1px solid rgba(255,204,51,0.4); background: rgba(0,0,0,0.3); color: white; border-radius: 8px; text-align: center; }
        .btn-panel { width: 100%; padding: 11px; margin-top: 6px; border-radius: 8px; font-weight: 900; text-transform: uppercase; font-size: 12px; border: none; cursor: pointer; }
        .btn-panel-gold { background: linear-gradient(180deg, #ffcc33 0%, #ff9900 100%); color: #000; }
        .btn-panel-outline { background: transparent; border: 1px solid var(--gold); color: var(--gold); }
        .btn-small { padding: 5px 10px; font-size: 10px; font-weight: bold; border-radius: 4px; border: none; cursor: pointer; }
        
        .acc-panel { margin-top: 54%; }
        .top-panel { margin-top: 57%; height: 350px; }
        .profile-panel { margin-top: 56%; }
        .shop-panel { margin-top: 56%; }
        .clocks-panel { margin-top: 62%; }
        .workers-panel { margin-top: 57%; height: 320px; }

        /* ТАБЛИЦА ЧАСОВ */
        .hours-unified-panel { width: 85%; margin-top: 15%; background: var(--dark-overlay); border: 2px solid var(--gold); border-radius: 15px; overflow: hidden; }
        .table-scroll-container { height: 380px; overflow-y: auto; }
        .hours-table-main { width: 100%; border-collapse: collapse; color: white; font-size: 12px; }
        .hours-table-main th { position: sticky; top: 0; background: var(--gold); color: #000; padding: 10px 2px; }
        .hours-table-main td { border-bottom: 1px solid rgba(255,255,255,0.08); padding: 5px 2px; text-align: center; }
        .hour-input-cell { width: 90%; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,204,51,0.2); color: white; text-align: center; padding: 4px; border-radius: 4px; }
        
        .beautiful-btns-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; padding: 10px; }
        .btn-beaut { padding: 10px; border-radius: 8px; font-weight: 900; font-size: 10px; border: none; text-transform: uppercase; }

        /* ЛИДЕРБОРД */
        .leaderboard-box { width: 100%; flex-grow: 1; overflow-y: auto; }
        .leaderboard-table { width: 100%; color: white; font-size: 11px; border-collapse: collapse; margin-bottom: 10px; }
        .leaderboard-table td { padding: 6px; text-align: center; border-bottom: 1px solid rgba(255,255,255,0.05); }
        .stat-header { width: 100%; text-align: center; background: rgba(255,204,51,0.1); color: var(--gold); font-size: 10px; font-weight: bold; padding: 4px; margin-top: 5px; }
        
        /* СТАТИСТИКА СЧЕТА */
        .stat-row { display: flex; justify-content: space-between; width: 100%; padding: 6px 0; border-bottom: 1px solid rgba(255,255,255,0.05); font-size: 13px; color: white; }
        .stat-value { color: var(--gold); font-weight: bold; }

        /* МАГАЗИН */
        .shop-item { display: flex; justify-content: space-between; align-items: center; width: 100%; padding: 10px; border-bottom: 1px solid #333; color: white; font-size: 13px; }
        .shop-price { color: var(--gold); font-weight: bold; margin-right: 10px; }
    </style>
</head>
<body onclick="hideKeyboard(event)">

    <div id="loader-screen" class="screen" style="display: block;">
        <div class="canvas">
            <div class="loader-content">
                <div class="progress-container"><div class="progress-bar" id="progress-bar"></div></div>
                <div id="loading-text">0%</div>
            </div>
        </div>
    </div>

    <div id="menu-screen" class="screen">
        <div class="canvas">
            <div class="top-logo-box">
                <img src="https://raw.githubusercontent.com/cryptokakhnych/monek-system-v2/refs/heads/main/793A440C-0C46-4BAD-A352-8F31E47BB1D6.png" class="header-logo">
            </div>

            <div class="menu-container">
                <div class="menu-item" id="m-profile"><img src="https://raw.githubusercontent.com/cryptokakhnych/monek-system-v2/refs/heads/main/D6D08605-797C-407A-AC9F-CA1D85241C3A.png" class="menu-icon" id="img-profile"></div>
                <div class="menu-item" id="m-clocks"><img src="https://raw.githubusercontent.com/cryptokakhnych/monek-system-v2/refs/heads/main/8CF47A13-928B-47FC-9494-D6354E56BB25.png" class="menu-icon" id="img-clocks"></div>
                
                <div class="menu-item" id="m-advances"><img src="https://raw.githubusercontent.com/cryptokakhnych/monek-system-v2/refs/heads/main/9B30F657-53D7-4158-91D6-5F004D6E3D19.png" class="menu-icon" id="img-advances"></div>
                <div class="menu-item" id="m-top"><img src="https://raw.githubusercontent.com/cryptokakhnych/monek-system-v2/refs/heads/main/1656CF23-37C3-4E2D-B9B5-7A86688E4DC0.png" class="menu-icon" id="img-top"></div>
                <div class="menu-item" id="m-shop"><img src="https://raw.githubusercontent.com/cryptokakhnych/monek-system-v2/refs/heads/main/6E3CA577-B227-4A8B-9929-A020B6B6AF5C.png" class="menu-icon" id="img-shop"></div>
                <div class="menu-item" id="m-account"><img src="https://raw.githubusercontent.com/cryptokakhnych/monek-system-v2/refs/heads/main/96CCD0ED-D67B-4AD3-823E-35FD2BECCAB2.png" class="menu-icon" id="img-account"></div>
                <div class="menu-item" id="m-workers"><img src="https://raw.githubusercontent.com/cryptokakhnych/monek-system-v2/refs/heads/main/F0374C7C-C546-4CF7-8BCD-3E8137BEC8EA.png" class="menu-icon" id="img-workers"></div>
                <div class="menu-item" id="m-dayoff"><img src="https://raw.githubusercontent.com/cryptokakhnych/monek-system-v2/refs/heads/main/EBD0902B-4CCD-44C4-94FD-C5CF1E27F3F5.png" class="menu-icon" id="img-dayoff"></div>
            </div>
        </div>
    </div>

    <div id="profile-screen" class="screen"><div class="canvas"><div class="panel-container profile-panel"><div class="panel-title">Профиль</div><input type="text" id="prof-login" class="panel-input" placeholder="Логин"><input type="text" id="prof-dob" class="panel-input" placeholder="Дата рождения"><input type="text" id="prof-workdate" class="panel-input" placeholder="Дата начала работы"><input type="text" id="prof-id" class="panel-input" placeholder="ID (для синхронизации)"><button class="btn-panel btn-panel-gold" onclick="submitProfile()">СОХРАНИТЬ</button><button class="btn-panel btn-panel-outline" onclick="backToMenu()">НАЗАД</button></div></div></div>
    
    <div id="clocks-screen" class="screen"><div class="canvas"><div class="panel-container clocks-panel"><div class="panel-title">Мои фирмы</div><div id="firm-list-container" style="width:100%; max-height: 200px; overflow-y:auto; margin-bottom:10px;"></div><button class="btn-panel btn-panel-gold" onclick="addFirm()">ДОБАВИТЬ ФИРМУ</button><button class="btn-panel btn-panel-outline" onclick="backToMenu()">НАЗАД</button></div></div></div>
    
    <div id="hours-screen" class="screen"><div class="canvas"><div class="hours-unified-panel"><div id="current-firm-name" style="text-align:center; color:gold; padding:10px; font-weight:900;">ФИРМА</div><div class="table-scroll-container"><table class="hours-table-main"><thead><tr><th>Д</th><th>ОТ</th><th>ДО</th><th>Ч</th><th>ОБЪЕКТ</th></tr></thead><tbody id="hours-tbody"></tbody></table></div><div style="color:gold; text-align:right; padding:10px; font-weight:900;">ИТОГО: <span id="table-total-val">0</span> Ч</div><div class="beautiful-btns-grid"><button class="btn-beaut" style="background:green; color:white;" onclick="saveHoursData()">Сохранить</button><button class="btn-beaut" style="background:red; color:white;" onclick="clearHoursData()">Очистить</button><button class="btn-beaut" style="background:gold; color:black;" onclick="sendHoursReport()">Отправить</button><button class="btn-beaut" style="background:#333; color:white;" onclick="closeHoursScreen()">Назад</button></div></div></div></div>
    
    <div id="account-screen" class="screen"><div class="canvas"><div class="panel-container acc-panel"><div class="panel-title">Финансовый отчет</div><div id="acc-stats-box" style="width:100%;"></div><button class="btn-panel btn-panel-outline" onclick="backToMenu()" style="margin-top:15px;">НАЗАД</button></div></div></div>
    
    <div id="top-screen" class="screen"><div class="canvas"><div class="panel-container top-panel"><div class="panel-title">Лидеры и Статистика</div><div class="leaderboard-box" id="leaderboard-content"></div><button class="btn-panel btn-panel-outline" onclick="backToMenu()">НАЗАД</button></div></div></div>
    
    <div id="advances-screen" class="screen"><div class="canvas"><div class="panel-container" style="margin-top:60%;"><div class="panel-title">Аванс</div><input type="number" id="adv-amount" class="panel-input" placeholder="Сумма"><input type="text" id="adv-reason" class="panel-input" placeholder="Причина"><button class="btn-panel btn-panel-gold" onclick="alert('Отправлено')">ОТПРАВИТЬ</button><button class="btn-panel btn-panel-outline" onclick="backToMenu()">НАЗАД</button></div></div></div>
    
    <div id="shop-screen" class="screen"><div class="canvas"><div class="panel-container shop-panel"><div class="panel-title">Магазин</div>
        <div style="width:100%; margin-bottom: 15px;">
            <div class="shop-item">
                <span>Сахарок</span>
                <div><span class="shop-price">500 CZK</span> <button class="btn-small btn-panel-gold" onclick="buyItem('Сахарок', 500)">КУПИТЬ</button></div>
            </div>
            <div class="shop-item">
                <span>Зеленая</span>
                <div><span class="shop-price">1500 CZK</span> <button class="btn-small btn-panel-gold" onclick="buyItem('Зеленая', 1500)">КУПИТЬ</button></div>
            </div>
        </div>
        <button class="btn-panel btn-panel-outline" onclick="backToMenu()">НАЗАД</button>
    </div></div></div>
    
    <div id="workers-screen" class="screen"><div class="canvas"><div class="panel-container workers-panel"><div class="panel-title">Работники</div><div id="workers-list" style="width:100%; overflow-y:auto;"></div><button class="btn-panel btn-panel-outline" onclick="backToMenu()" style="margin-top:10px;">НАЗАД</button></div></div></div>
    
    <div id="dayoff-screen" class="screen"><div class="canvas"><div class="panel-container" style="margin-top:60%;"><div class="panel-title">Выходной</div><input type="text" class="panel-input" placeholder="Дата"><input type="text" class="panel-input" placeholder="Причина"><button class="btn-panel btn-panel-gold" onclick="alert('Заявка принята')">ЗАКАЗАТЬ</button><button class="btn-panel btn-panel-outline" onclick="backToMenu()">НАЗАД</button></div></div></div>

    <script>
        const SUPABASE_URL = 'https://mnexoturnujxjjicfukc.supabase.co'; 
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1uZXhvdHVybnVqeGpqaWNmdWtjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk1MTY1MzksImV4cCI6MjA4NTA5MjUzOX0.Ye4PJuEpuyLLRACkv72tvf0mh7IBn7JYRA8OJ1kLrc0';
        const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        let firms = JSON.parse(localStorage.getItem('monek_firms')) || ["Monek Group"];
        let dbUsers = [];
        let curF = "";

        async function initApp() {
            renderFirms();
            generateDaysTable();
            await loadProfileData();
            await fetchLeaderboardData();

            // Привязываем клики по иконкам
            document.getElementById('img-profile').onclick = () => showScreen('profile-screen');
            document.getElementById('img-clocks').onclick = () => showScreen('clocks-screen');
            document.getElementById('img-advances').onclick = () => showScreen('advances-screen');
            document.getElementById('img-top').onclick = () => showScreen('top-screen');
            document.getElementById('img-shop').onclick = () => showScreen('shop-screen');
            document.getElementById('img-account').onclick = () => { fetchLeaderboardData(); showScreen('account-screen'); };
            document.getElementById('img-workers').onclick = () => showScreen('workers-screen');
            document.getElementById('img-dayoff').onclick = () => showScreen('dayoff-screen');

            const bar = document.getElementById('progress-bar');
            const txt = document.getElementById('loading-text');
            let start = Date.now(), dur = 2000;
            
            const frame = () => {
                let pct = Math.min(((Date.now()-start)/dur)*100, 100);
                bar.style.width = pct+'%'; 
                txt.innerText = Math.floor(pct)+'%';
                if(pct < 100) requestAnimationFrame(frame);
                else setTimeout(() => showScreen('menu-screen'), 300);
            };
            requestAnimationFrame(frame);
        }

        function showScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.style.display = 'none');
            document.getElementById(id).style.display = 'block';
        }

        function backToMenu() { showScreen('menu-screen'); }

        async function submitProfile() {
            const p = {
                login: document.getElementById('prof-login').value,
                dob: document.getElementById('prof-dob').value,
                work: document.getElementById('prof-workdate').value,
                external_id: document.getElementById('prof-id').value
            };
            localStorage.setItem('monek_prof', JSON.stringify(p));
            await supabaseClient.from('profiles').upsert([p], { onConflict: 'external_id' });
            alert("Сохранено!");
            backToMenu();
        }

        async function loadProfileData() {
            let p = JSON.parse(localStorage.getItem('monek_prof'));
            if(p) {
                document.getElementById('prof-login').value = p.login || "";
                document.getElementById('prof-dob').value = p.dob || "";
                document.getElementById('prof-workdate').value = p.work || "";
                document.getElementById('prof-id').value = p.external_id || "";
            }
        }

        function renderFirms() {
            const c = document.getElementById('firm-list-container');
            c.innerHTML = '';
            firms.forEach((f, i) => {
                c.innerHTML += `<div style="display:flex; justify-content:space-between; padding:10px; border-bottom:1px solid #333; color:white; align-items:center;">
                    <span>${f}</span>
                    <button class="btn-panel-gold btn-small" onclick="openHours('${f}')" style="font-weight:900;">ВЫБРАТЬ</button>
                </div>`;
            });
        }

        function addFirm() {
            let n = prompt("Название фирмы:");
            if(n) { firms.push(n); localStorage.setItem('monek_firms', JSON.stringify(firms)); renderFirms(); }
        }

        function generateDaysTable() {
            const b = document.getElementById('hours-tbody');
            b.innerHTML = '';
            for(let i=1; i<=31; i++) {
                b.innerHTML += `<tr>
                    <td>${i}</td>
                    <td><input type="number" class="hour-input-cell inp-f" oninput="calcH(this)"></td>
                    <td><input type="number" class="hour-input-cell inp-t" oninput="calcH(this)"></td>
                    <td class="res-h">0</td>
                    <td><input type="text" class="hour-input-cell inp-s"></td>
                </tr>`;
            }
        }

        function openHours(f) {
            curF = f;
            document.getElementById('current-firm-name').innerText = f;
            const saved = JSON.parse(localStorage.getItem('h_'+f)) || [];
            const rows = document.querySelectorAll('#hours-tbody tr');
            rows.forEach((tr, i) => {
                const d = saved[i] || {};
                tr.querySelector('.inp-f').value = d.f || "";
                tr.querySelector('.inp-t').value = d.t || "";
                tr.querySelector('.res-h').innerText = d.h || "0";
                tr.querySelector('.inp-s').value = d.s || "";
            });
            updateTotal();
            showScreen('hours-screen');
        }

        function calcH(el) {
            const tr = el.closest('tr');
            const f = parseFloat(tr.querySelector('.inp-f').value);
            const t = parseFloat(tr.querySelector('.inp-t').value);
            const res = tr.querySelector('.res-h');
            if(f && t && t > f) {
                let h = (t - f) - 0.5;
                res.innerText = h > 0 ? h : 0;
            } else res.innerText = "0";
            updateTotal();
        }

        function updateTotal() {
            let total = 0;
            document.querySelectorAll('.res-h').forEach(td => total += parseFloat(td.innerText) || 0);
            document.getElementById('table-total-val').innerText = total;
        }

        function saveHoursData() {
            const data = Array.from(document.querySelectorAll('#hours-tbody tr')).map(tr => ({
                f: tr.querySelector('.inp-f').value,
                t: tr.querySelector('.inp-t').value,
                h: tr.querySelector('.res-h').innerText,
                s: tr.querySelector('.inp-s').value
            }));
            localStorage.setItem('h_'+curF, JSON.stringify(data));
            alert("Данные сохранены локально");
        }

        function clearHoursData() {
            if(confirm("Очистить таблицу?")) {
                localStorage.removeItem('h_'+curF);
                openHours(curF);
            }
        }

        function sendHoursReport() {
            saveHoursData();
            alert("Отчет по фирме " + curF + " отправлен в базу!");
            backToMenu();
        }

        function closeHoursScreen() { showScreen('clocks-screen'); }

        async function fetchLeaderboardData() {
            const { data } = await supabaseClient.from('profiles').select('*');
            if(data) {
                dbUsers = data;
                renderTopStats();
                renderWorkers();
                updateMyStats();
            }
        }

        function renderTopStats() {
            const container = document.getElementById('leaderboard-content');
            
            // Расчет общих авансов
            let totalAdvCZK = 0;
            dbUsers.forEach(u => totalAdvCZK += (u.advCzk || 0));
            let totalAdvEUR = Math.round(totalAdvCZK / 25); // Примерный курс

            // Топ по Зарплате
            let sortedBySal = [...dbUsers].sort((a,b) => (b.salary||0) - (a.salary||0)).slice(0, 5);
            
            // Топ по Авансам
            let sortedByAdv = [...dbUsers].sort((a,b) => (b.advCzk||0) - (a.advCzk||0)).slice(0, 5);
            
            // Топ по Стажу (имитация по ID или дате, если есть, пока по ЗП для примера)
            let sortedByExp = [...dbUsers].sort((a,b) => (a.external_id||0) - (b.external_id||0)).slice(0, 5);

            let html = `
                <div style="width:100%; border-bottom:1px solid gold; padding-bottom:5px; margin-bottom:10px; text-align:center; color:white; font-size:12px;">
                    <span style="color:gold;">ВСЕГО ВЫДАНО АВАНСОВ:</span><br>
                    ${totalAdvCZK} CZK / ~${totalAdvEUR} EUR
                </div>

                <div class="stat-header">ТОП ЗАРПЛАТА</div>
                <table class="leaderboard-table">
                    ${sortedBySal.map((u,i) => `<tr><td>${i+1}</td><td>${u.login}</td><td style="color:gold;">${u.salary||0}</td></tr>`).join('')}
                </table>

                <div class="stat-header">ТОП АВАНСЫ</div>
                <table class="leaderboard-table">
                    ${sortedByAdv.map((u,i) => `<tr><td>${i+1}</td><td>${u.login}</td><td style="color:red;">${u.advCzk||0}</td></tr>`).join('')}
                </table>
                
                <div class="stat-header">ТОП СТАЖ (Veterans)</div>
                <table class="leaderboard-table">
                    ${sortedByExp.map((u,i) => `<tr><td>${i+1}</td><td>${u.login}</td><td style="color:#aaa;">ID: ${u.external_id}</td></tr>`).join('')}
                </table>
            `;
            container.innerHTML = html;
        }

        function renderWorkers() {
            const c = document.getElementById('workers-list');
            c.innerHTML = "";
            dbUsers.forEach(u => {
                c.innerHTML += `<div style="padding:10px; border-bottom:1px solid #222; color:white; display:flex; justify-content:space-between; align-items:center;">
                    <div>
                        <div style="font-weight:bold;">${u.login}</div>
                        <div style="color:#666; font-size:10px;">ID: ${u.external_id}</div>
                    </div>
                    <button class="btn-panel-gold btn-small" onclick="alert('Выбран: ${u.login}')">ВЫБРАТЬ</button>
                </div>`;
            });
        }

        function updateMyStats() {
            const myId = document.getElementById('prof-id').value;
            const u = dbUsers.find(x => x.external_id == myId);
            const box = document.getElementById('acc-stats-box');
            if(u) {
                box.innerHTML = `
                    <div class="stat-row"><span>Работник:</span><span class="stat-value" style="color:white;">${u.login}</span></div>
                    <div class="stat-row"><span>Ставка:</span><span class="stat-value">150 CZK/ч</span></div>
                    <div class="stat-row"><span>Отработано часов:</span><span class="stat-value">${(u.salary/150).toFixed(1) || 0} ч</span></div>
                    <div style="width:100%; height:1px; background:#333; margin:5px 0;"></div>
                    <div class="stat-row"><span>Начислено:</span><span class="stat-value" style="color:lime;">+${u.salary || 0} CZK</span></div>
                    <div class="stat-row"><span>Авансы:</span><span class="stat-value" style="color:red;">-${u.advCzk || 0} CZK</span></div>
                    <div class="stat-row"><span>Штрафы:</span><span class="stat-value" style="color:red;">-${u.fines || 0} CZK</span></div>
                    <div class="stat-row" style="border-top:1px solid gold; margin-top:10px; padding-top:10px;">
                        <span>К ВЫДАЧЕ НА РУКИ:</span><span class="stat-value" style="font-size:18px; color:gold;">${(u.salary||0) - (u.advCzk||0) - (u.fines||0)} CZK</span>
                    </div>
                `;
            } else {
                box.innerHTML = `<div style="color:gray; text-align:center; padding:20px;">Введите ваш ID в профиле для загрузки статистики.</div>`;
            }
        }

        function buyItem(name, price) {
            if(confirm(`Купить ${name} за ${price} CZK?`)) {
                alert("Покупка совершена! Списано: " + price + " CZK");
            }
        }

        function hideKeyboard(e) {
            if(e.target.tagName !== 'INPUT') document.activeElement.blur();
        }

        window.onload = initApp;
    </script>
</body>
</html>
