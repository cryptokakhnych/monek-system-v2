<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Monek System v5.5 - Keyboard Scroll Only</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root {
            --gold: #ffcc33;
            --dark-overlay: rgba(10, 10, 10, 0.96);
            /* –§–æ–Ω 1 (–ì–ª–∞–≤–Ω–∞—è –∏ –ù–∞—á–∞–ª–æ —á–∞—Å–æ–≤) */
            --bg-main: url('https://raw.githubusercontent.com/cryptokakhnych/monek-system-v2/refs/heads/main/BEE1273C-8A49-4B01-B2D5-31E01244A38C.png');
            --bg-loader: url('https://raw.githubusercontent.com/cryptokakhnych/monek-system-v2/refs/heads/main/DE0BFEBD-58A8-4CA4-A803-10BDD5E177A2.png');
            --bg-menu: url('https://raw.githubusercontent.com/cryptokakhnych/monek-system-v2/refs/heads/main/F4AAC9F1-4AFA-411A-8D97-82C5F86FE825.png');
            /* –§–æ–Ω 2 (–ü–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ —Ñ–∏—Ä–º—ã) */
            --bg-hours: url('https://raw.githubusercontent.com/cryptokakhnych/monek-system-v2/refs/heads/main/2A2B5DCA-E3CC-4307-AA90-BEC512A1BC8A.png');
        }

        * {
            margin: 0; padding: 0; box-sizing: border-box;
            -webkit-tap-highlight-color: transparent; -webkit-user-select: none; user-select: none;
        }

        input { -webkit-user-select: text; user-select: text; }

        body, html {
            width: 100%; height: 100%; 
            background-color: #000;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            overflow: hidden; /* –ì–ª–æ–±–∞–ª—å–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Å–∫—Ä–æ–ª–ª–∞ body */
            overscroll-behavior: none;
        }

        #fixed-bg {
            position: fixed; 
            top: 0; left: 0; 
            width: 100%; height: 100%;
            z-index: 0;
            background-size: 100% 100%;
            background-position: center top;
            background-repeat: no-repeat;
            transition: background-image 0.2s ease;
            pointer-events: none;
            will-change: transform;
        }

        .screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            display: none; 
            z-index: 5; 
            /* –ò–ó–ú–ï–ù–ï–ù–ò–ï: –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å–∫—Ä–æ–ª–ª –ó–ê–ü–†–ï–©–ï–ù */
            overflow: hidden; 
            background: transparent; 
        }

        /* –ö–ª–∞—Å—Å, –∫–æ—Ç–æ—Ä—ã–π –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è JS-–æ–º, –∫–æ–≥–¥–∞ –æ—Ç–∫—Ä—ã—Ç–∞ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ */
        .screen.keyboard-active {
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        .canvas {
            position: relative; width: 100%;
            min-height: 100%; 
            display: flex; flex-direction: column; align-items: center;
            /* –£–º–µ–Ω—å—à–∏–ª –Ω–∏–∂–Ω–∏–π –æ—Ç—Å—Ç—É–ø, —á—Ç–æ–±—ã –∫–æ–Ω—Ç–µ–Ω—Ç –Ω–µ —É–ª–µ—Ç–∞–ª —Å–ª–∏—à–∫–æ–º –¥–∞–ª–µ–∫–æ */
            padding-bottom: 100px; 
        }

        .top-logo-box { position: absolute; top: 5%; width: 100%; display: flex; justify-content: center; z-index: 5; pointer-events: none; }
        #menu-screen .top-logo-box { top: -5.5%; } 
        
        .header-logo { width: 210px; }

        .menu-container {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 10;
        }

        .menu-item {
            position: absolute; display: flex; justify-content: center; align-items: center;
            border: 2px solid transparent; 
            cursor: pointer;
        }

        .menu-icon {
            max-width: 100%; max-height: 100%; pointer-events: none;
            filter: drop-shadow(0 4px 6px rgba(0,0,0,0.4));
            transition: transform 0.2s ease;
        }

        #img-profile  { transform: scale(2.5) translate(0px, 4px); }
        #img-clocks   { transform: scale(2.5) translate(0px, 5.5px); }
        #img-advances { transform: scale(2.5) translate(0px, 11px); }
        #img-top      { transform: scale(2.5) translate(0px, 3.5px); }
        #img-shop     { transform: scale(2.7) translate(0px, 3.5px); }
        #img-account  { transform: scale(2.9) translate(0.3px, 3.5px); }
        #img-workers  { transform: scale(2.8) translate(0px, 7.5px); }
        #img-dayoff   { transform: scale(2.5) translate(0.5px, 4.5px); }

        #m-profile  { top: 34%; left: 20.0%; width: 20%; height: 10%; }
        #m-clocks   { top: 33.5%; left: 60.5%; width: 20%; height: 10%; }
        #m-workers  { top: 47%; left: 20.0%; width: 20%; height: 10%; }
        #m-top      { top: 47%; left: 60.5%; width: 20%; height: 10%; }
        #m-advances { top: 59.5%; left: 19.5%; width: 20%; height: 10%; }
        #m-account  { top: 59.5%; left: 60%; width: 20%; height: 10%; }
        #m-shop     { top: 72.5%; left: 20.0%; width: 20%; height: 10%; }
        #m-dayoff   { top: 72.5%; left: 59.5%; width: 20%; height: 10%; }

        .loader-content { position: absolute; top: 46%; width: 100%; display: flex; flex-direction: column; align-items: center; }
        .progress-container { width: 60%; height: 14px; background: rgba(0,0,0,0.6); border-radius: 20px; border: 2px solid rgba(255,255,255,0.4); overflow: hidden; }
        .progress-bar { height: 100%; width: 0%; background: linear-gradient(90deg, #ffcc33, #ff6600); }
        #loading-text { color: var(--gold); font-size: 20px; margin-top: 12px; font-weight: 900; -webkit-text-stroke: 1.2px black; text-shadow: 2px 2px 0px rgba(0,0,0,1); }

        .panel-container {
            width: 78%; background: var(--dark-overlay);
            border: 1px solid var(--gold); border-radius: 12px;
            padding: 12px; display: flex; flex-direction: column;
            align-items: center; box-shadow: 0 10px 40px rgba(0,0,0,0.9);
            margin-bottom: 50px; z-index: 10;
        }
        .panel-title { color: var(--gold); font-weight: 900; text-transform: uppercase; margin-bottom: 10px; font-size: 13px; width: 100%; text-align: center; }
        .panel-header-row { display: flex; justify-content: space-between; width: 100%; align-items: center; margin-bottom: 10px; }
        
        .panel-input { width: 100%; padding: 10px; margin-bottom: 8px; border: 1px solid rgba(255,204,51,0.4); background: rgba(0,0,0,0.3); color: white; border-radius: 8px; text-align: center; }
        .btn-panel { width: 100%; padding: 11px; margin-top: 6px; border-radius: 8px; font-weight: 900; text-transform: uppercase; font-size: 12px; border: none; cursor: pointer; }
        .btn-panel-gold { background: linear-gradient(180deg, #ffcc33 0%, #ff9900 100%); color: #000; }
        .btn-panel-outline { background: transparent; border: 1px solid var(--gold); color: var(--gold); }
        .btn-small { padding: 5px 10px; font-size: 10px; font-weight: bold; border-radius: 4px; border: none; cursor: pointer; }
        
        .btn-icon-action { width: 30px; height: 30px; border-radius: 4px; border: none; font-weight: 900; font-size: 16px; cursor: pointer; display: flex; align-items: center; justify-content: center; margin-left: 5px; }
        .btn-green { background: #00cc00; color: white; }
        .btn-red { background: #cc0000; color: white; }

        .btn-header-action { background: transparent; border: 1px solid var(--gold); color: var(--gold); width: 30px; height: 30px; border-radius: 50%; font-weight: 900; font-size: 16px; margin-left: 5px; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        .btn-header-action.active { background: red; color: white; border-color: red; }

        .acc-panel { margin-top: 54%; }
        .top-panel { margin-top: 52%; height: 340px; }
        .profile-panel { margin-top: 56%; }
        .shop-panel { margin-top: 56%; }
        .clocks-panel { margin-top: 62%; }
        .workers-panel { margin-top: 57%; height: 320px; }
        .worker-edit-panel { margin-top: 55%; }
        .adv-panel { margin-top: 60%; }
        .do-panel { margin-top: 60%; }

        .hours-unified-panel { width: 85%; margin-top: 15%; background: var(--dark-overlay); border: 2px solid var(--gold); border-radius: 15px; overflow: hidden; margin-bottom: 50px; z-index: 10; }
        /* –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π —Å–∫—Ä–æ–ª–ª –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã —Ä–∞–±–æ—Ç–∞–µ—Ç –≤—Å–µ–≥–¥–∞ */
        .table-scroll-container { height: 380px; overflow-y: auto; -webkit-overflow-scrolling: touch; }
        .hours-table-main { width: 100%; border-collapse: collapse; color: white; font-size: 12px; }
        .hours-table-main th { position: sticky; top: 0; background: var(--gold); color: #000; padding: 10px 2px; }
        .hours-table-main td { border-bottom: 1px solid rgba(255,255,255,0.08); padding: 5px 2px; text-align: center; }
        .hour-input-cell { width: 90%; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,204,51,0.2); color: white; text-align: center; padding: 4px; border-radius: 4px; }
        
        .beautiful-btns-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; padding: 10px; }
        .btn-beaut { padding: 10px; border-radius: 8px; font-weight: 900; font-size: 10px; border: none; text-transform: uppercase; }

        .leaderboard-box { width: 100%; flex-grow: 1; overflow-y: auto; margin-top: 10px; -webkit-overflow-scrolling: touch; }
        .leaderboard-table { width: 100%; color: white; font-size: 11px; border-collapse: collapse; margin-bottom: 10px; }
        .leaderboard-table td { padding: 6px; text-align: center; border-bottom: 1px solid rgba(255,255,255,0.05); }
        
        .top-tabs { display: flex; width: 100%; justify-content: space-between; margin-bottom: 5px; }
        .top-tab { flex: 1; border: 1px solid var(--gold); color: var(--gold); background: transparent; padding: 5px; font-size: 10px; font-weight: bold; cursor: pointer; }
        .top-tab.active { background: var(--gold); color: black; }
        .top-tab:first-child { border-radius: 6px 0 0 6px; }
        .top-tab:last-child { border-radius: 0 6px 6px 0; }

        .stat-total-box { width: 100%; border-bottom: 1px solid var(--gold); padding-bottom: 5px; margin-bottom: 5px; text-align: center; color: white; font-size: 11px; }

        .stat-row { display: flex; justify-content: space-between; width: 100%; padding: 8px 0; border-bottom: 1px solid rgba(255,255,255,0.05); font-size: 13px; color: white; align-items: center; }
        .stat-value { color: var(--gold); font-weight: bold; }

        .shop-row { display: flex; flex-direction: column; width: 100%; margin-bottom: 12px; border-bottom: 1px solid #333; padding-bottom: 10px; }
        .shop-info { display: flex; justify-content: space-between; color: white; font-size: 13px; margin-bottom: 5px; }
        .shop-controls { display: flex; justify-content: space-between; align-items: center; }
        .shop-qty-input { width: 60px; padding: 5px; text-align: center; border-radius: 4px; border: 1px solid var(--gold); background: transparent; color: white; }
        .shop-calc-price { color: var(--gold); font-weight: bold; font-size: 14px; }
        .shop-subtext { font-size: 10px; color: #aaa; }

        .worker-cat-row { display: flex; justify-content: space-between; align-items: center; width: 100%; padding: 8px 0; border-bottom: 1px solid #333; color: white; font-size: 13px; }
        .calc-panel-inline { width: 100%; display: flex; gap: 5px; margin-top: 5px; display: none; align-items: center; }
        .calc-panel-inline.active { display: flex; }
        .calc-input { flex: 1; padding: 5px; background: rgba(0,0,0,0.5); border: 1px solid var(--gold); color: white; border-radius: 4px; text-align: center; }

        /* –û—Ç–¥–µ–ª—å–Ω—ã–π —Å–∫—Ä–æ–ª–ª –¥–ª—è —Å–ø–∏—Å–∫–∞ —Ñ–∏—Ä–º –∏ —Ä–∞–±–æ—Ç–Ω–∏–∫–æ–≤ */
        #firm-list-container, #workers-list { -webkit-overflow-scrolling: touch; }

    </style>
</head>
<body onclick="hideKeyboard(event)">

    <div id="fixed-bg"></div>

    <div id="loader-screen" class="screen" style="display: block;">
        <div class="canvas">
            <div class="loader-content">
                <div class="progress-container"><div class="progress-bar" id="progress-bar"></div></div>
                <div id="loading-text">0%</div>
            </div>
        </div>
    </div>

    <div id="menu-screen" class="screen">
        <div class="canvas">
            <div class="top-logo-box">
                <img src="https://raw.githubusercontent.com/cryptokakhnych/monek-system-v2/refs/heads/main/793A440C-0C46-4BAD-A352-8F31E47BB1D6.png" class="header-logo">
            </div>
            <div class="menu-container">
                <div class="menu-item" id="m-profile"><img src="https://raw.githubusercontent.com/cryptokakhnych/monek-system-v2/refs/heads/main/D6D08605-797C-407A-AC9F-CA1D85241C3A.png" class="menu-icon" id="img-profile"></div>
                <div class="menu-item" id="m-clocks"><img src="https://raw.githubusercontent.com/cryptokakhnych/monek-system-v2/refs/heads/main/8CF47A13-928B-47FC-9494-D6354E56BB25.png" class="menu-icon" id="img-clocks"></div>
                <div class="menu-item" id="m-advances"><img src="https://raw.githubusercontent.com/cryptokakhnych/monek-system-v2/refs/heads/main/9B30F657-53D7-4158-91D6-5F004D6E3D19.png" class="menu-icon" id="img-advances"></div>
                <div class="menu-item" id="m-top"><img src="https://raw.githubusercontent.com/cryptokakhnych/monek-system-v2/refs/heads/main/1656CF23-37C3-4E2D-B9B5-7A86688E4DC0.png" class="menu-icon" id="img-top"></div>
                <div class="menu-item" id="m-shop"><img src="https://raw.githubusercontent.com/cryptokakhnych/monek-system-v2/refs/heads/main/6E3CA577-B227-4A8B-9929-A020B6B6AF5C.png" class="menu-icon" id="img-shop"></div>
                <div class="menu-item" id="m-account"><img src="https://raw.githubusercontent.com/cryptokakhnych/monek-system-v2/refs/heads/main/96CCD0ED-D67B-4AD3-823E-35FD2BECCAB2.png" class="menu-icon" id="img-account"></div>
                <div class="menu-item" id="m-workers"><img src="https://raw.githubusercontent.com/cryptokakhnych/monek-system-v2/refs/heads/main/F0374C7C-C546-4CF7-8BCD-3E8137BEC8EA.png" class="menu-icon" id="img-workers"></div>
                <div class="menu-item" id="m-dayoff"><img src="https://raw.githubusercontent.com/cryptokakhnych/monek-system-v2/refs/heads/main/EBD0902B-4CCD-44C4-94FD-C5CF1E27F3F5.png" class="menu-icon" id="img-dayoff"></div>
            </div>
        </div>
    </div>

    <div id="profile-screen" class="screen">
        <div class="canvas">
            <div class="panel-container profile-panel">
                <div class="panel-title">–ü—Ä–æ—Ñ–∏–ª—å</div>
                <input type="text" id="prof-login" class="panel-input" placeholder="–õ–æ–≥–∏–Ω">
                <input type="text" id="prof-dob" class="panel-input" placeholder="–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è">
                <input type="text" id="prof-workdate" class="panel-input" placeholder="–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã (27.05.2025)">
                <input type="text" id="prof-id" class="panel-input" placeholder="ID (–¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏)">
                <button class="btn-panel btn-panel-gold" onclick="submitProfile()">–°–û–•–†–ê–ù–ò–¢–¨</button>
                <button class="btn-panel btn-panel-outline" onclick="backToMenu()">–ù–ê–ó–ê–î</button>
            </div>
        </div>
    </div>
    
    <div id="clocks-screen" class="screen">
        <div class="canvas">
            <div class="panel-container clocks-panel">
                <div class="panel-header-row">
                    <span style="color:var(--gold); font-weight:900;">–ú–û–ò –§–ò–†–ú–´</span>
                    <div style="display:flex;">
                        <button class="btn-header-action" onclick="addFirm()">+</button>
                        <button class="btn-header-action" id="btn-del-mode" onclick="toggleDelFirm()">-</button>
                    </div>
                </div>
                <div id="firm-list-container" style="width:100%; max-height: 200px; overflow-y:auto; margin-bottom:10px;"></div>
                <button class="btn-panel btn-panel-outline" onclick="backToMenu()">–ù–ê–ó–ê–î</button>
            </div>
        </div>
    </div>
    
    <div id="hours-screen" class="screen">
        <div class="canvas">
            <div class="hours-unified-panel">
                <div id="current-firm-name" style="text-align:center; color:gold; padding:10px; font-weight:900;">–§–ò–†–ú–ê</div>
                <div class="table-scroll-container">
                    <table class="hours-table-main"><thead><tr><th>–î</th><th>–û–¢</th><th>–î–û</th><th>–ß</th><th>–û–ë–™–ï–ö–¢</th></tr></thead><tbody id="hours-tbody"></tbody></table>
                </div>
                <div style="color:gold; text-align:right; padding:10px; font-weight:900;">–ò–¢–û–ì–û: <span id="table-total-val">0</span> –ß</div>
                <div class="beautiful-btns-grid">
                    <button class="btn-beaut" style="background:green; color:white;" onclick="saveHoursData(true)">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                    <button class="btn-beaut" style="background:red; color:white;" onclick="clearHoursData()">–û—á–∏—Å—Ç–∏—Ç—å</button>
                    <button class="btn-beaut" style="background:gold; color:black;" onclick="sendHoursReport()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
                    <button class="btn-beaut" style="background:#333; color:white;" onclick="closeHoursScreen()">–ù–∞–∑–∞–¥</button>
                </div>
            </div>
        </div>
    </div>
    
    <div id="account-screen" class="screen">
        <div class="canvas">
            <div class="panel-container acc-panel">
                <div class="panel-title">–§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –æ—Ç—á–µ—Ç</div>
                <div id="acc-stats-box" style="width:100%;"></div>
                <button class="btn-panel btn-panel-outline" onclick="backToMenu()" style="margin-top:15px;">–ù–ê–ó–ê–î</button>
            </div>
        </div>
    </div>
    
    <div id="top-screen" class="screen">
        <div class="canvas">
            <div class="panel-container top-panel">
                <div class="top-tabs">
                    <button class="top-tab active" onclick="switchTopTab('adv')" id="tab-adv">–¢–û–ü –ê–í–ê–ù–°</button>
                    <button class="top-tab" onclick="switchTopTab('exp')" id="tab-exp">–¢–û–ü –°–¢–ê–ñ</button>
                </div>
                <div class="leaderboard-box" id="leaderboard-content"></div>
                <button class="btn-panel btn-panel-outline" onclick="backToMenu()">–ù–ê–ó–ê–î</button>
            </div>
        </div>
    </div>
    
    <div id="advances-screen" class="screen">
        <div class="canvas">
            <div class="panel-container adv-panel">
                <div class="panel-title">–ê–≤–∞–Ω—Å</div>
                <input type="number" id="adv-amount" class="panel-input" placeholder="–°—É–º–º–∞">
                <input type="text" id="adv-reason" class="panel-input" placeholder="–ü—Ä–∏—á–∏–Ω–∞">
                <button class="btn-panel btn-panel-gold" onclick="alert('–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ')">–û–¢–ü–†–ê–í–ò–¢–¨</button>
                <button class="btn-panel btn-panel-outline" onclick="backToMenu()">–ù–ê–ó–ê–î</button>
            </div>
        </div>
    </div>
    
    <div id="shop-screen" class="screen">
        <div class="canvas">
            <div class="panel-container shop-panel">
                <div class="panel-title">–ú–∞–≥–∞–∑–∏–Ω</div>
                
                <div class="shop-row">
                    <div class="shop-info">
                        <span>–°–∞—Ö–∞—Ä–æ–∫ <span class="shop-subtext">(—á–∞—Ä–∞)</span></span>
                        <span>200 CZK</span>
                    </div>
                    <div class="shop-controls">
                        <input type="number" class="shop-qty-input" id="shop-qty-sugar" placeholder="–ö–æ–ª." oninput="calcShop()">
                        <span class="shop-calc-price" id="shop-price-sugar">0 CZK</span>
                    </div>
                </div>

                <div class="shop-row">
                    <div class="shop-info">
                        <span>–ó–µ–ª–µ–Ω–∞—è <span class="shop-subtext">(–≥)</span></span>
                        <span>150 CZK</span>
                    </div>
                    <div class="shop-controls">
                        <input type="number" class="shop-qty-input" id="shop-qty-green" placeholder="–ö–æ–ª." oninput="calcShop()">
                        <span class="shop-calc-price" id="shop-price-green">0 CZK</span>
                    </div>
                </div>

                <div style="width:100%; text-align:right; font-weight:900; color:var(--gold); margin-top:10px; font-size:16px;">
                    –ò–¢–û–ì–û: <span id="shop-total">0</span> CZK
                </div>

                <button class="btn-panel btn-panel-gold" style="margin-top:10px;" onclick="orderShop()">–ó–ê–ö–ê–ó–ê–¢–¨</button>
                <button class="btn-panel btn-panel-outline" onclick="backToMenu()">–ù–ê–ó–ê–î</button>
            </div>
        </div>
    </div>
    
    <div id="workers-screen" class="screen">
        <div class="canvas">
            <div class="panel-container workers-panel">
                <div class="panel-title">–†–∞–±–æ—Ç–Ω–∏–∫–∏</div>
                <div id="workers-list" style="width:100%; overflow-y:auto;"></div>
                <button class="btn-panel btn-panel-outline" onclick="backToMenu()" style="margin-top:10px;">–ù–ê–ó–ê–î</button>
            </div>
        </div>
    </div>

    <div id="worker-edit-screen" class="screen">
        <div class="canvas">
            <div class="panel-container worker-edit-panel">
                <div class="panel-title" id="we-title">–†–∞–±–æ—Ç–Ω–∏–∫</div>
                <div id="we-content" style="width:100%;">
                    </div>
                <button class="btn-panel btn-panel-outline" onclick="showScreen('workers-screen')" style="margin-top:15px;">–ù–ê–ó–ê–î</button>
            </div>
        </div>
    </div>
    
    <div id="dayoff-screen" class="screen">
        <div class="canvas">
            <div class="panel-container do-panel">
                <div class="panel-title">–í—ã—Ö–æ–¥–Ω–æ–π</div>
                <input type="text" class="panel-input" id="do-date" placeholder="–î–∞—Ç–∞">
                <input type="text" class="panel-input" id="do-reason" placeholder="–ü—Ä–∏—á–∏–Ω–∞">
                <button class="btn-panel btn-panel-gold" onclick="sendDayOff()">–û–¢–ü–†–ê–í–ò–¢–¨</button>
                <button class="btn-panel btn-panel-outline" onclick="backToMenu()">–ù–ê–ó–ê–î</button>
            </div>
        </div>
    </div>

    <script>
        const fixedBg = document.getElementById('fixed-bg');
        const SUPABASE_URL = 'https://mnexoturnujxjjicfukc.supabase.co'; 
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1uZXhvdHVybnVqeGpqaWNmdWtjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk1MTY1MzksImV4cCI6MjA4NTA5MjUzOX0.Ye4PJuEpuyLLRACkv72tvf0mh7IBn7JYRA8OJ1kLrc0';
        const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        let firms = JSON.parse(localStorage.getItem('monek_firms')) || ["Monek Group"];
        let dbUsers = [];
        let curF = "";
        let deleteMode = false;
        let currentWorkerId = null;

        // --- –õ–û–ì–ò–ö–ê –ë–õ–û–ö–ò–†–û–í–ö–ò –°–ö–†–û–õ–õ–ê ---
        // –ò–¥–µ—è: –°–∫—Ä–æ–ª–ª –∑–∞–ø—Ä–µ—â–µ–Ω –≤—Å–µ–≥–¥–∞, –∫—Ä–æ–º–µ —Å–ª—É—á–∞–µ–≤, –∫–æ–≥–¥–∞ —Ñ–æ–∫—É—Å –≤ input
        
        // 1. –ü—Ä–∏ —Ñ–æ–∫—É—Å–µ –≤ –ª—é–±–æ–π input —Ä–∞–∑—Ä–µ—à–∞–µ–º —Å–∫—Ä–æ–ª–ª —ç–∫—Ä–∞–Ω—É
        document.addEventListener('focus', function(e) {
            if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') {
                const activeScreen = document.querySelector('.screen[style*="block"]');
                if (activeScreen) {
                    activeScreen.classList.add('keyboard-active');
                    // –ù–µ–±–æ–ª—å—à–æ–π —Ç–∞–π–º–∞—É—Ç, —á—Ç–æ–±—ã –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ —É—Å–ø–µ–ª–∞ –≤—ã–µ—Ö–∞—Ç—å, –∑–∞—Ç–µ–º —Å–∫—Ä–æ–ª–ª–∏–º –∫ —ç–ª–µ–º–µ–Ω—Ç—É
                    setTimeout(() => {
                        e.target.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }, 300);
                }
            }
        }, true);

        // 2. –ü—Ä–∏ –ø–æ—Ç–µ—Ä–µ —Ñ–æ–∫—É—Å–∞ (–±–ª—é—Ä–µ) –∑–∞–ø—Ä–µ—â–∞–µ–º —Å–∫—Ä–æ–ª–ª –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –Ω–∞–≤–µ—Ä—Ö
        document.addEventListener('blur', function(e) {
            if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') {
                const activeScreen = document.querySelector('.screen[style*="block"]');
                if (activeScreen) {
                    activeScreen.classList.remove('keyboard-active');
                    activeScreen.scrollTo({ top: 0, behavior: 'smooth' });
                }
            }
        }, true);

        // --- –ö–û–ù–ï–¶ –õ–û–ì–ò–ö–ò –°–ö–†–û–õ–õ–ê ---

        function parseDate(input) {
            if(!input) return null;
            if(input.includes('.')) {
                const parts = input.split('.');
                if(parts.length === 3) return new Date(parts[2], parts[1]-1, parts[0]);
            }
            const d = new Date(input);
            return isNaN(d.getTime()) ? null : d;
        }

        async function initApp() {
            renderFirms();
            generateDaysTable();
            await loadProfileData();
            await fetchLeaderboardData();

            setBg('var(--bg-loader)');

            document.getElementById('m-profile').onclick = () => showScreen('profile-screen', 'var(--bg-main)');
            document.getElementById('m-clocks').onclick = () => showScreen('clocks-screen', 'var(--bg-main)');
            document.getElementById('m-advances').onclick = () => showScreen('advances-screen', 'var(--bg-main)');
            document.getElementById('m-top').onclick = () => { fetchLeaderboardData(); switchTopTab('adv'); showScreen('top-screen', 'var(--bg-main)'); };
            document.getElementById('m-shop').onclick = () => showScreen('shop-screen', 'var(--bg-main)');
            document.getElementById('m-account').onclick = () => { fetchLeaderboardData(); showScreen('account-screen', 'var(--bg-main)'); };
            document.getElementById('m-workers').onclick = () => { fetchLeaderboardData(); showScreen('workers-screen', 'var(--bg-main)'); };
            document.getElementById('m-dayoff').onclick = () => showScreen('dayoff-screen', 'var(--bg-main)');

            const bar = document.getElementById('progress-bar');
            const txt = document.getElementById('loading-text');
            let start = Date.now(), dur = 2000;
            const frame = () => {
                let pct = Math.min(((Date.now()-start)/dur)*100, 100);
                bar.style.width = pct+'%'; 
                txt.innerText = Math.floor(pct)+'%';
                if(pct < 100) requestAnimationFrame(frame);
                else setTimeout(() => showScreen('menu-screen', 'var(--bg-menu)'), 300);
            };
            requestAnimationFrame(frame);
        }

        function setBg(imgVar) {
            fixedBg.style.backgroundImage = imgVar;
        }

        function showScreen(id, bgVar) {
            document.querySelectorAll('.screen').forEach(s => {
                s.style.display = 'none';
                s.classList.remove('keyboard-active'); // –°–±—Ä–æ—Å —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–∫—Ä–æ–ª–ª–∞ –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ
            });
            const targetScreen = document.getElementById(id);
            targetScreen.style.display = 'block';
            targetScreen.scrollTop = 0; // –í—Å–µ–≥–¥–∞ –Ω–∞—á–∏–Ω–∞—Ç—å —Å–≤–µ—Ä—Ö—É

            if(bgVar) setBg(bgVar);
        }

        function backToMenu() { showScreen('menu-screen', 'var(--bg-menu)'); }

        async function submitProfile() {
            const p = {
                login: document.getElementById('prof-login').value,
                dob: document.getElementById('prof-dob').value,
                work: document.getElementById('prof-workdate').value,
                external_id: document.getElementById('prof-id').value
            };
            localStorage.setItem('monek_prof', JSON.stringify(p));
            await supabaseClient.from('profiles').upsert([{
                external_id: p.external_id, login: p.login, dob: p.dob, work_date: p.work
            }], { onConflict: 'external_id' });
            alert("–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ!");
            backToMenu();
        }

        async function loadProfileData() {
            let p = JSON.parse(localStorage.getItem('monek_prof'));
            if(p) {
                document.getElementById('prof-login').value = p.login || "";
                document.getElementById('prof-dob').value = p.dob || "";
                document.getElementById('prof-workdate').value = p.work || "";
                document.getElementById('prof-id').value = p.external_id || "";
            }
        }

        function renderFirms() {
            const c = document.getElementById('firm-list-container');
            c.innerHTML = '';
            firms.forEach((f, i) => {
                let actionBtn = deleteMode 
                    ? `<span style="font-size:20px; cursor:pointer;" onclick="deleteFirm(${i})">üóëÔ∏è</span>`
                    : `<button class="btn-panel-gold btn-small" onclick="openHours('${f}')" style="font-weight:900;">–í–´–ë–†–ê–¢–¨</button>`;
                c.innerHTML += `<div style="display:flex; justify-content:space-between; padding:10px; border-bottom:1px solid #333; color:white; align-items:center;">
                    <span>${f}</span><div>${actionBtn}</div></div>`;
            });
        }

        function addFirm() {
            let n = prompt("–ù–∞–∑–≤–∞–Ω–∏–µ —Ñ–∏—Ä–º—ã:");
            if(n) { firms.push(n); localStorage.setItem('monek_firms', JSON.stringify(firms)); renderFirms(); }
        }

        function toggleDelFirm() {
            deleteMode = !deleteMode;
            document.getElementById('btn-del-mode').classList.toggle('active', deleteMode);
            renderFirms();
        }

        function deleteFirm(index) {
            if(confirm('–£–¥–∞–ª–∏—Ç—å —Ñ–∏—Ä–º—É?')) {
                firms.splice(index, 1);
                localStorage.setItem('monek_firms', JSON.stringify(firms));
                deleteMode = false;
                document.getElementById('btn-del-mode').classList.remove('active');
                renderFirms();
            }
        }

        function generateDaysTable() {
            const b = document.getElementById('hours-tbody');
            b.innerHTML = '';
            for(let i=1; i<=31; i++) {
                b.innerHTML += `<tr><td>${i}</td><td><input type="number" class="hour-input-cell inp-f" oninput="calcH(this)"></td>
                    <td><input type="number" class="hour-input-cell inp-t" oninput="calcH(this)"></td><td class="res-h">0</td>
                    <td><input type="text" class="hour-input-cell inp-s"></td></tr>`;
            }
        }

        function openHours(f) {
            curF = f;
            document.getElementById('current-firm-name').innerText = f;
            const saved = JSON.parse(localStorage.getItem('h_'+f)) || [];
            document.querySelectorAll('#hours-tbody tr').forEach((tr, i) => {
                const d = saved[i] || {};
                tr.querySelector('.inp-f').value = d.f || "";
                tr.querySelector('.inp-t').value = d.t || "";
                tr.querySelector('.res-h').innerText = d.h || "0";
                tr.querySelector('.inp-s').value = d.s || "";
            });
            updateTotal();
            showScreen('hours-screen', 'var(--bg-hours)');
        }

        function calcH(el) {
            const tr = el.closest('tr');
            const f = parseFloat(tr.querySelector('.inp-f').value);
            const t = parseFloat(tr.querySelector('.inp-t').value);
            const res = tr.querySelector('.res-h');
            if(f && t && t > f) { let h = (t - f) - 0.5; res.innerText = h > 0 ? h : 0; } else res.innerText = "0";
            updateTotal();
        }

        function updateTotal() {
            let total = 0;
            document.querySelectorAll('.res-h').forEach(td => total += parseFloat(td.innerText) || 0);
            document.getElementById('table-total-val').innerText = total;
        }

        async function saveHoursData(showAlert = false) {
            const data = Array.from(document.querySelectorAll('#hours-tbody tr')).map(tr => ({
                f: tr.querySelector('.inp-f').value, t: tr.querySelector('.inp-t').value,
                h: tr.querySelector('.res-h').innerText, s: tr.querySelector('.inp-s').value
            }));
            localStorage.setItem('h_'+curF, JSON.stringify(data));
            if(showAlert) alert("–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ");
        }

        function clearHoursData() {
            localStorage.removeItem('h_'+curF);
            document.querySelectorAll('#hours-tbody tr').forEach(tr => {
                tr.querySelector('.inp-f').value = ""; tr.querySelector('.inp-t').value = "";
                tr.querySelector('.res-h').innerText = "0"; tr.querySelector('.inp-s').value = "";
            });
            updateTotal();
        }

        function sendHoursReport() { saveHoursData(); clearHoursData(); alert("–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ"); backToMenu(); }
        function closeHoursScreen() { showScreen('clocks-screen', 'var(--bg-main)'); }

        async function fetchLeaderboardData() {
            const { data } = await supabaseClient.from('profiles').select('*');
            if(data) { dbUsers = data; renderWorkers(); updateMyStats(); }
        }

        function updateMyStats() {
            const savedProf = JSON.parse(localStorage.getItem('monek_prof')) || {};
            const myId = savedProf.external_id || document.getElementById('prof-id').value;
            const u = dbUsers.find(x => String(x.external_id) === String(myId));
            const box = document.getElementById('acc-stats-box');
            if(u) {
                const toPay = (u.salary||0) - (u.adv_czk||0) - (u.fines||0);
                box.innerHTML = `<div class="stat-row"><span>–ó–∞—Ä–ø–ª–∞—Ç–∞:</span><span class="stat-value" style="color:lime;">${u.salary || 0} CZK</span></div>
                    <div class="stat-row"><span>–ê–≤–∞–Ω—Å—ã –∫—Ä–æ–Ω—ã:</span><span class="stat-value" style="color:red;">${u.adv_czk || 0} CZK</span></div>
                    <div class="stat-row"><span>–ê–≤–∞–Ω—Å—ã –µ–≤—Ä–æ:</span><span class="stat-value" style="color:red;">${u.adv_eur || 0} EUR</span></div>
                    <div class="stat-row"><span>–®—Ç—Ä–∞—Ñ—ã:</span><span class="stat-value" style="color:red;">${u.fines || 0} CZK</span></div>
                    <div class="stat-row" style="border-top:1px solid gold; margin-top:5px; padding-top:10px;">
                    <span>–ö –í–´–î–ê–ß–ï:</span><span class="stat-value" style="font-size:18px; color:gold;">${toPay} CZK</span></div>`;
            } else box.innerHTML = `<div style="color:gray; text-align:center; padding:20px;">–î–∞–Ω–Ω—ã–µ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.<br>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ ID –≤ –ø—Ä–æ—Ñ–∏–ª–µ.</div>`;
        }

        function switchTopTab(tab) {
            document.querySelectorAll('.top-tab').forEach(t => t.classList.remove('active'));
            document.getElementById('tab-'+tab).classList.add('active');
            const container = document.getElementById('leaderboard-content');
            if(tab === 'adv') {
                let totCzk = 0, totEur = 0; dbUsers.forEach(u => { totCzk += (u.adv_czk||0); totEur += (u.adv_eur||0); });
                let html = `<div class="stat-total-box"><span style="color:gold;">–í –û–ë–©–ï–ú:</span><br>${totCzk} CZK | ${totEur} EUR</div><table class="leaderboard-table">`;
                [...dbUsers].sort((a,b) => ((b.adv_czk||0)+(b.adv_eur||0)*24) - ((a.adv_czk||0)+(a.adv_eur||0)*24)).forEach((u, i) => {
                    html += `<tr><td>${i+1}</td><td style="text-align:left;">${u.login}</td><td>${u.adv_czk||0} CZK</td><td style="color:gold;">${u.adv_eur||0} ‚Ç¨</td></tr>`;
                });
                container.innerHTML = html + `</table>`;
            } else {
                let html = `<table class="leaderboard-table">`;
                [...dbUsers].map(u => {
                    let d = 0, s = parseDate(u.work_date);
                    if(s) d = Math.floor((new Date() - s) / 86400000);
                    return { ...u, d: d > 0 ? d : 0 };
                }).sort((a,b) => b.d - a.d).forEach((u, i) => {
                    html += `<tr><td>${i+1}</td><td style="text-align:left;">${u.login}</td><td style="color:gold;">${u.d} –¥–Ω.</td></tr>`;
                });
                container.innerHTML = html + `</table>`;
            }
        }

        function calcShop() {
            const qS = parseFloat(document.getElementById('shop-qty-sugar').value) || 0;
            const qG = parseFloat(document.getElementById('shop-qty-green').value) || 0;
            document.getElementById('shop-price-sugar').innerText = (qS*200) + " CZK";
            document.getElementById('shop-price-green').innerText = (qG*150) + " CZK";
            document.getElementById('shop-total').innerText = (qS*200 + qG*150);
        }

        function orderShop() { alert("–ó–∞–∫–∞–∑–∞–Ω–æ"); backToMenu(); }
        function sendDayOff() { alert("–ó–∞–ø—Ä–æ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω"); backToMenu(); }

        function renderWorkers() {
            const c = document.getElementById('workers-list'); c.innerHTML = "";
            dbUsers.forEach(u => {
                c.innerHTML += `<div style="padding:10px; border-bottom:1px solid #222; color:white; display:flex; justify-content:space-between; align-items:center;">
                    <div><b>${u.login}</b><div style="color:#666; font-size:10px;">ID: ${u.external_id}</div></div>
                    <button class="btn-panel-gold btn-small" onclick="openWorkerEdit('${u.external_id}')">–í–´–ë–†–ê–¢–¨</button></div>`;
            });
        }

        function openWorkerEdit(id) {
            currentWorkerId = id; const u = dbUsers.find(x => x.external_id == id); if(!u) return;
            document.getElementById('we-title').innerText = u.login;
            const cats = [{id:'sal', name:'–ó–∞—Ä–ø–ª–∞—Ç–∞', f:'salary', u:'CZK'}, {id:'ae', name:'–ê–≤–∞–Ω—Å—ã EUR', f:'adv_eur', u:'EUR'}, {id:'ac', name:'–ê–≤–∞–Ω—Å—ã CZK', f:'adv_czk', u:'CZK'}, {id:'fin', name:'–®—Ç—Ä–∞—Ñ—ã', f:'fines', u:'CZK'}];
            let h = '';
            cats.forEach(c => {
                h += `<div style="margin-bottom:10px;"><div class="worker-cat-row"><span>${c.name} (<span style="color:gold">${u[c.f]||0} ${c.u}</span>)</span><button class="btn-small btn-panel-outline" onclick="toggleCalc('${c.id}')">–í–´–ë–†–ê–¢–¨</button></div>
                    <div id="calc-${c.id}" class="calc-panel-inline"><input type="number" id="inp-${c.id}" class="calc-input" placeholder="–°—É–º–º–∞">
                    <button class="btn-icon-action btn-green" onclick="updateWorkerStat('${c.f}', '${c.id}', 1)">‚úî</button>
                    <button class="btn-icon-action btn-red" onclick="updateWorkerStat('${c.f}', '${c.id}', -1)">‚úñ</button></div></div>`;
            });
            document.getElementById('we-content').innerHTML = h;
            showScreen('worker-edit-screen', 'var(--bg-main)');
        }

        function toggleCalc(id) { document.querySelectorAll('.calc-panel-inline').forEach(el => el.classList.remove('active')); document.getElementById('calc-'+id).classList.add('active'); }

        async function updateWorkerStat(field, inpId, mul) {
            const amt = parseFloat(document.getElementById('inp-'+inpId).value); if(!amt || amt < 0) return;
            const u = dbUsers.find(x => x.external_id == currentWorkerId);
            const val = (parseFloat(u[field])||0) + (amt * mul); u[field] = val;
            openWorkerEdit(currentWorkerId);
            await supabaseClient.from('profiles').update({ [field]: val }).eq('external_id', currentWorkerId);
        }

        function hideKeyboard(e) { if(e.target.tagName !== 'INPUT' && e.target.tagName !== 'BUTTON' && e.target.tagName !== 'TEXTAREA') { document.activeElement.blur(); } }

        window.onload = initApp;
    </script>
</body>
</html>
